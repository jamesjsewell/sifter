!function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}(),s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i=function(){function s(t){e(this,s),this.context=t,this.theGame=this.context.theGame,this.create_level_select()}return t(s,[{key:"create_level_select",value:function(){console.log(this.theGame),this.lvl_select_bg=this.theGame.add.sprite(0,0,"atlas"),this.lvl_select_bg.alignIn(this.theGame.camera.view,Phaser.BOTTOM_CENTER),this.level1Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.startGame,this,"lvl2.png","lvl1.png"),this.level1Button.anchor.setTo(.5),this.level2Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.startGame,this,"lvl4.png","lvl3.png"),this.level2Button.anchor.setTo(-.8,.5),this.level3Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.startGame,this,"lvl6.png","lvl5.png"),this.level3Button.anchor.setTo(-2.1,.5),this.level4Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.startGame,this,"lvl8.png","lvl7.png"),this.level4Button.anchor.setTo(-3.4,.5),this.lvl_select_bg.addChild(this.level1Button),this.lvl_select_bg.addChild(this.level2Button),this.lvl_select_bg.addChild(this.level3Button),this.lvl_select_bg.addChild(this.level4Button),this.lvl_select_bg.frameName="level_select_bg.png"}}]),s}(),h=function(){function s(t){e(this,s),this.context=t,this.theGame=this.context.theGame,this.width=this.theGame._width,this.height=this.theGame._height,this.create_main_menu()}return t(s,[{key:"create_main_menu",value:function(){this.button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.startGame,this,"play_button2.png","play_button1.png"),this.button.frameName="play_button1.png",this.button.x=this.width/2-this.button.texture.frame.width/2,this.button.y=this.height/2-this.button.texture.frame.height/2,this.levelSelect=new i(this)}},{key:"startGame",value:function(){this.theGame.state.start("Game")}}]),s}(),r=function(i){function r(){return e(this,r),a(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return s(r,i),t(r,[{key:"init",value:function(){this.theGame=this.game.state.game,this.width=this.theGame._width,this.height=this.theGame._height}},{key:"create",value:function(){this.menu_features=new h(this)}},{key:"update",value:function(){}},{key:"render",value:function(){}},{key:"startGame",value:function(){}}]),r}(Phaser.State),o=function(i){function h(){return e(this,h),a(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,i),t(h,[{key:"init",value:function(){this.theGame=this.game.state.game,this.w=this.theGame.width,this.h=this.theGame.height,this.selectedTilesArray=[],this.selected=!1,this.deadEnds=[],this.alreadyMatched=[],this.currentCell=null,this.cycles=0,this.done=!1,this.level=1}},{key:"preload",value:function(){}},{key:"create",value:function(){var e=this;this.theTileMap=this.theGame.add.tilemap("map2"),this.theTileMap.addTilesetImage("tiles"),this.layer1=this.theTileMap.createLayer("level_1"),this.currentLayerIndex=this.theTileMap.getLayer(this.theTileMap.currentLayer),console.log(this.currentLayerIndex),this.theGame.input.onDown.add(this.getTileProperties,this),this.theTileMap.forEach(function(t){t.properties&&("source"===t.properties.type&&(e.sourceBlock=t,e.firstInChain=e.theTileMap.getTileRight(e.currentLayerIndex,e.sourceBlock.x,e.sourceBlock.y)),"destination"===t.properties.type&&(e.destinationBlock=t))},this,0,0,6,6,this.currentLayerIndex)}},{key:"update",value:function(){}},{key:"render",value:function(){}},{key:"checkForRoadStart",value:function(){var e=this.theTileMap.getTileRight(this.currentLayerIndex,this.sourceBlock.x,this.sourceBlock.y);e&&!0===e.properties.left&&(this.currentCell=null,this.alreadyMatched=[],this.deadEnds=[],this.alreadyMatched[0]=e,this.cycles=0,this.traversePath(e))}},{key:"traversePath",value:function(e){if(!1===this.done){var t=this.testConnections(e,this.alreadyMatched);if(!0===this.done)return;if(this.cycles=this.cycles+1,t=this.testConnections(e,this.alreadyMatched)){if(this.alreadyMatched.push(e),e=null,t&&t.length)for(var s=0;s<=t.length;s++)t[s]&&(e=t[s]);e&&(this.cycles<20?this.traversePath(e):console.log("cycle limit reached"))}else this.deadEnds.includes(e)||e&&this.deadEnds.push(e),this.cycles<20?this.alreadyMatched.length&&(e=this.alreadyMatched[this.alreadyMatched.length],this.traversePath(e)):console.log("cycle limit reached, dead end")}}},{key:"testConnections",value:function(e,t){var s=[];if(e&&e.properties){var a=this.theTileMap.getTileAbove(this.currentLayerIndex,e.x,e.y),i=this.theTileMap.getTileBelow(this.currentLayerIndex,e.x,e.y),h=this.theTileMap.getTileLeft(this.currentLayerIndex,e.x,e.y),r=this.theTileMap.getTileRight(this.currentLayerIndex,e.x,e.y),o=e.properties;if(a)var n=a.properties;if(i)var l=i.properties;if(h)var c=h.properties;if(r)var u=r.properties;return n&&!0===n.bottom&&!0===o.top&&(t.includes(a)||this.deadEnds.includes(a)||s.push(a)),l&&!0===l.top&&!0===o.bottom&&(t.includes(i)||this.deadEnds.includes(i)||s.push(i)),c&&!0===c.right&&!0===o.left&&(t.includes(h)||this.deadEnds.includes(h)||s.push(h)),!u||(console.log(u),!0!==u.left||!0!==o.right||t.includes(r)||this.deadEnds.includes(r)||(s.push(r),"destination"!==u.type))?s.length?s:null:(console.log("donne"),this.currentCell=null,this.alreadyMatched=[],this.cycles=0,this.done=!0,1===this.level?this.level=2:this.level=1,void this.change_level())}}},{key:"getTileProperties",value:function(){var e=this.layer1.getTileX(this.theGame.input.activePointer.worldX),t=this.layer1.getTileY(this.theGame.input.activePointer.worldY),s=this.theTileMap.getTile(e,t);return this.selectedTilesArray.length||"connector"!==s.properties.type&&"blank"!==s.properties.type?!0!==this.selected||(s||console.log("drop selection"),!s||"connector"!==s.properties.type&&"blank"!==s.properties.type)?void 0:(this.selectedTilesArray[1]=s,this.swap(),void this.remove_selector()):(this.selectedTilesArray[0]=s,this.selected=!0,void this.create_selector(s.worldX,s.worldY))}},{key:"swap",value:function(){var e=this.selectedTilesArray[0],t=new Phaser.Tile(this.currentLayerIndex),s=this.selectedTilesArray[1],a=new Phaser.Tile(this.currentLayerIndex);for(var i in s)s.hasOwnProperty(i)&&(a[i]=s[i]);for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);this.theTileMap.putTile(e,a.x,a.y,this.currentLayerIndex),this.theTileMap.putTile(a,t.x,t.y,this.currentLayerIndex),this.selectedTilesArray=[],this.selected=!1,this.done=!1,this.checkForRoadStart()}},{key:"create_selector",value:function(e,t){this.selector?(this.selector.x=e,this.selector.y=t,this.selector.visible=!0):(this.selector=this.theGame.add.sprite(e,t,"atlas",this.currentLayerIndex),this.selector.frameName="selector.png")}},{key:"remove_selector",value:function(){this.selector.visible=!1}},{key:"change_level",value:function(){var e=this;this.level,2===this.level&&(this.layer1.destroy(),this.layer1=this.theTileMap.createLayer("level_2"),this.layer1.exists=!0,this.theTileMap.setLayer(this.layer1),this.currentLayerIndex=this.theTileMap.getLayer(this.theTileMap.currentLayer),console.log(this.currentLayerIndex),this.selector.bringToTop()),this.selectedTilesArray=[],this.selected=!1,this.deadEnds=[],this.alreadyMatched=[],this.currentCell=null,this.cycles=0,this.done=!1,this.theTileMap.forEach(function(t){t.properties&&("source"===t.properties.type&&(e.sourceBlock=t,e.firstInChain=e.theTileMap.getTileRight(e.currentLayerIndex,e.sourceBlock.x,e.sourceBlock.y)),"destination"===t.properties.type&&(e.destinationBlock=t))},this,0,0,6,6,this.currentLayerIndex),console.log(this.sourceBlock)}}]),h}(Phaser.State),n=function(i){function h(){return e(this,h),a(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,i),t(h,[{key:"init",value:function(){}},{key:"preload",value:function(){}},{key:"create",value:function(){}},{key:"update",value:function(){}},{key:"render",value:function(){}}]),h}(Phaser.State),l=function(i){function h(){return e(this,h),a(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,i),t(h,[{key:"init",value:function(){this.theGame=this.game.state.game,this.score=0}},{key:"preload",value:function(){}},{key:"create",value:function(){this.cursors=this.theGame.input.keyboard.createCursorKeys(),this.theGame.physics.startSystem(Phaser.Physics.ARCADE),this.theGame.add.sprite(0,0,"sky"),this.platforms=this.theGame.add.group(),this.platforms.enableBody=!0,this.ground=this.platforms.create(0,this.theGame.world.height-64,"ground"),this.ground.scale.setTo(2,2),this.ground.body.immovable=!0,this.ledge=this.platforms.create(400,480,"ground"),this.ledge.body.immovable=!0,this.ledge=this.platforms.create(-100,440,"ground"),this.ledge.body.immovable=!0,this.ledge=this.platforms.create(200,400,"ground"),this.ledge.scale.setTo(.2,.5),this.ledge.body.immovable=!0,this.player=this.theGame.add.sprite(32,this.theGame.world.height-150,"dude"),this.theGame.physics.arcade.enable(this.player),this.player.body.bounce.y=.2,this.player.body.gravity.y=900,this.player.body.collideWorldBounds=!0,this.player.animations.add("left",[0,1,2,3],10,!0),this.player.animations.add("right",[5,6,7,8],10,!0),this.stars=this.theGame.add.group(),this.stars.enableBody=!0;for(var e=0;e<12;e++){var t=this.stars.create(70*e,0,"star");t.body.gravity.y=900,t.body.bounce.y=.7+.2*Math.random()}this.scoreText=this.theGame.add.text(650,0,"score: 0",{font:"18px Arial",fill:"#ffffff",align:"right"}),this.scoreText.fixedToCamera=!0,this.scoreText.cameraOffset.setTo(650,0),this.seeker=this.theGame.add.sprite(400,300,"../assets/images/diamond.png"),this.seeker.anchor.setTo(.5,.5),this.theGame.physics.enable(this.seeker,Phaser.Physics.ARCADE),this.seeker.body.allowRotation=!1,this.pause_menu()}},{key:"update",value:function(){this.theGame.world.setBounds(0,0,1920,1920),this.theGame.camera.follow(this.player,Phaser.Camera.FOLLOW_LOCKON,.1,.1);var e=this.theGame.physics.arcade.collide(this.player,this.platforms);this.player.body.velocity.x=0,this.cursors.left.isDown?(this.player.body.velocity.x=-150,this.player.animations.play("left")):this.cursors.right.isDown?(this.player.body.velocity.x=150,this.player.animations.play("right")):(this.player.animations.stop(),this.player.frame=4),this.cursors.up.isDown&&this.player.body.touching.down&&e&&(this.player.body.velocity.y=-350),this.theGame.physics.arcade.collide(this.stars,this.platforms),this.theGame.physics.arcade.overlap(this.player,this.stars,this.collectStar,null,this),this.seeker.rotation=this.theGame.physics.arcade.moveToPointer(this.seeker,60,this.theGame.input.activePointer,500)}},{key:"render",value:function(){var e=this.theGame.debug;e.scale(20,20,"#fff"),e.phaser(10,580)}},{key:"pause_menu",value:function(){var e=800,t=600;i(this),console.log(this.theGame);var s=this;function a(){s.theGame.paused=!0,s.pause_button.destroy(),s.menu=s.theGame.add.sprite(e/2,t/2,"menu");var a=s.theGame.camera.x,h=s.theGame.camera.y;s.choiceLabel=s.theGame.add.text(e/2,t-150,"Click outside menu to continue",{font:"30px Arial",fill:"#fff"}),s.menu.x=a+e/2-135,s.menu.y=h+t/2-90,s.menu.x=s.theGame.camera.x+e/2-135,s.menu.y=s.theGame.camera.y+t/2-90,s.choiceLabel.x=s.menu.x,s.choiceLabel.y=s.menu.y+t/3.5,s.resume_button=s.theGame.add.button(s.theGame.world.centerX,s.theGame.world.centerY,"resumeButton",function(e){s.resume_button.setFrames(0,1,2),s.theGame.paused&&(s.menu.destroy(),s.choiceLabel.destroy(),s.resume_button.destroy(),s.theGame.paused=!1,i(s))},s,1,0,2),s.resume_button.x=a+e/2-32,s.resume_button.y=h+20,s.theGame.input.onDown.add(function(a){if(s.theGame.paused){var i=e/2-135,h=e/2+135,r=t/2-90,o=t/2+90;if(a.x>i&&a.x<h&&a.y>r&&a.y<o){var n=a.x-i,l=a.y-r,c=Math.floor(n/90)+3*Math.floor(l/90);s.choiceLabel.text="You chose menu item: "+["one","two","three","four","five","six"][c]}}},s)}function i(t){t.pause_button=t.theGame.add.button(t.theGame.world.centerX,t.theGame.world.centerY,"pauseButton",a,this,1,0,2),t.pause_button.fixedToCamera=!0,t.pause_button.cameraOffset.setTo(e/2-32,20)}}},{key:"collectStar",value:function(e,t){t.kill(),this.score+=10,console.log(this.score),this.scoreText.text="score: "+this.score}}]),h}(Phaser.State),c=function(i){function h(){return e(this,h),a(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,i),t(h,[{key:"init",value:function(){}},{key:"preload",value:function(){}},{key:"create",value:function(){}},{key:"update",value:function(){}},{key:"render",value:function(){}}]),h}(Phaser.State),u=function(i){function h(){return e(this,h),a(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,i),t(h,[{key:"init",value:function(){this.theGame=this.game.state.game,this.addedStates=!1,this.theGame.load.onLoadStart.add(this.loadStart,this),this.theGame.load.onFileComplete.add(this.fileComplete,this),this.theGame.load.onLoadComplete.add(this.loadComplete,this),this.theGame.scale.aspectRatio=1,console.log(this.theGame.scale.aspectRatio),console.log(this.theGame)}},{key:"preload",value:function(){this.theGame.load.tilemap("map2","assets/images/tilemap_2.json",null,Phaser.Tilemap.TILED_JSON),this.theGame.load.tilemap("map3","assets/images/tilemap_3.json",null,Phaser.Tilemap.TILED_JSON),this.theGame.load.image("tiles","./assets/images/tilemap.png"),this.theGame.load.atlas("atlas","assets/images/atlas.png","assets/images/atlas.json"),this.theGame.load.image("button_bg","./assets/images/button_background.png"),this.theGame.load.image("sky","./assets/images/sky.png"),this.theGame.load.image("ground","./assets/images/platform.png"),this.theGame.load.image("star","./assets/images/star.png"),this.theGame.load.spritesheet("dude","./assets/images/dude.png",32,48),this.theGame.load.spritesheet("resumeButton","./assets/pause_menu/resume_button.png",32,32),this.theGame.load.spritesheet("pauseButton","./assets/pause_menu/pause_button.png",32,32),this.theGame.load.image("menu","./assets/images/number-buttons-90x90.png",270,180),this.theGame.load.bitmapFont("carrier_command","assets/fonts/carrier_command.png","assets/fonts/carrier_command.xml"),this.theGame.load.bitmapFont("gem","assets/fonts/gem.png","assets/fonts/gem.xml"),this.theGame.load.spritesheet("menu_start_button","./assets/main_menu/play_button.png",128,32),this.theGame.load.image("menu_bg","./assets/main_menu/menu_bg.png")}},{key:"create",value:function(){this.bmpText=this.theGame.add.bitmapText(10,100,"gem","LOADING...",34),this.addGameStates(),this.addGameMusic(),this.leftKey=this.theGame.input.keyboard.addKey(Phaser.Keyboard.LEFT),this.rightKey=this.theGame.input.keyboard.addKey(Phaser.Keyboard.RIGHT),this.spaceKey=this.theGame.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.theGame.input.keyboard.addKeyCapture([Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.SPACEBAR])}},{key:"update",value:function(){this.addedStates&&this.filesLoaded&&this.theGame.state.start("GameMenu")}},{key:"addGameStates",value:function(){this.theGame.state.add("GameMenu",r),this.theGame.state.add("Game",o),this.theGame.state.add("GameOver",n),this.theGame.state.add("Credits",l),this.theGame.state.add("Options",c),this.addedStates=!0}},{key:"addGameMusic",value:function(){}},{key:"loadStart",value:function(){console.log("loading")}},{key:"fileComplete",value:function(e,t,s,a,i){console.log(e)}},{key:"loadComplete",value:function(){this.filesLoaded=!0}}]),h}(Phaser.State);new(function(t){function i(){e(this,i);var t=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,{renderer:Phaser.AUTO,width:384,height:384,aspectRatio:1,crisp:!0,roundPixels:!0,alignH:!0,alignV:!0,scaleH:1,scaleV:1,trimH:0,trimV:0,scaleMode:Phaser.ScaleManager.SHOW_ALL,antialias:!0}));return t.state.add("Boot",u,!1),t.state.start("Boot"),t}return s(i,t),i}(Phaser.Game))}();
//# sourceMappingURL=compiled.js.map
