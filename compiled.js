!function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},a=function(){function s(t){e(this,s),this.context=t,this.theGame=this.context.theGame,this.create_level_select()}return t(s,[{key:"create_level_select",value:function(){this.lvl_select_bg=this.theGame.add.sprite(0,0,"atlas"),this.lvl_select_bg.alignIn(this.theGame.camera.view,Phaser.CENTER),this.level1Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.level1,this,"lvl2.png","lvl1.png"),this.level1Button.anchor.setTo(.5),this.level2Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.level2,this,"lvl4.png","lvl3.png"),this.level2Button.anchor.setTo(-.8,.5),this.level3Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.level3,this,"lvl6.png","lvl5.png"),this.level3Button.anchor.setTo(-2.1,.5),this.level4Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.level4,this,"lvl8.png","lvl7.png"),this.level4Button.anchor.setTo(-3.4,.5),this.lvl_select_bg.addChild(this.level1Button),this.lvl_select_bg.addChild(this.level2Button),this.lvl_select_bg.addChild(this.level3Button),this.lvl_select_bg.addChild(this.level4Button),this.lvl_select_bg.frameName="level_select_bg.png"}},{key:"level1",value:function(){this.startLevel(0)}},{key:"level2",value:function(){this.startLevel(1)}},{key:"level3",value:function(){this.startLevel(2)}},{key:"level4",value:function(){this.startLevel(3)}},{key:"startLevel",value:function(e){console.log(this),this.theGame.theLevel=e,this.theGame.state.start("Game")}}]),s}(),h=function(){function s(t){e(this,s),this.context=t,this.theGame=this.context.theGame,this.width=this.theGame._width,this.height=this.theGame._height,this.create_main_menu()}return t(s,[{key:"create_main_menu",value:function(){this.levelSelect=new a(this)}},{key:"startGame",value:function(){this.theGame.state.start("Game")}}]),s}(),l=function(a){function l(){return e(this,l),i(this,(l.__proto__||Object.getPrototypeOf(l)).apply(this,arguments))}return s(l,a),t(l,[{key:"init",value:function(){this.theGame=this.game.state.game,this.width=this.theGame._width,this.height=this.theGame._height}},{key:"create",value:function(){this.menu_features=new h(this)}},{key:"update",value:function(){}},{key:"render",value:function(){}},{key:"startGame",value:function(){}}]),l}(Phaser.State),n=function(a){function h(){return e(this,h),i(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,a),t(h,[{key:"init",value:function(){this.theGame=this.game.state.game,this.w=this.theGame.width,this.h=this.theGame.height,this.selectedTilesArray=[],this.selected=!1,this.deadEnds=[],this.alreadyMatched=[],this.currentCell=null,this.cycles=0,this.done=!1,this.level=this.theGame.theLevel}},{key:"preload",value:function(){}},{key:"create",value:function(){var e=this;this.theTileMap=this.theGame.add.tilemap("map2"),this.theTileMap.addTilesetImage("tiles"),this.layer1=this.theTileMap.createLayer(this.level),this.layer1.exists=!0,this.theTileMap.setLayer(this.layer1),this.currentLayerIndex=this.theTileMap.getLayer(this.theTileMap.currentLayer),this.currentLayerIndex=this.level,console.log(this.currentLayerIndex),this.theGame.input.onDown.add(this.getTileProperties,this),this.theTileMap.forEach(function(t){t.properties&&("source"===t.properties.type&&(e.sourceBlock=t,e.firstInChain=e.theTileMap.getTileRight(e.currentLayerIndex,e.sourceBlock.x,e.sourceBlock.y)),"destination"===t.properties.type&&(e.destinationBlock=t))},this,0,0,6,6,this.currentLayerIndex),this.selector=this.theGame.add.sprite(0,0,"atlas",this.currentLayerIndex),this.selector.frameName="selector.png",this.selector.visible=!1,this.marker=this.theGame.add.sprite(0,0,"atlas",this.currentLayerIndex),this.marker.frameName="marker.png",this.marker.anchor.setTo(0),this.theGame.input.addMoveCallback(this.updateMarker,this),this.startTime=new Date,this.totalTime=120,this.timeElapsed=0,this.createTimer(),this.gameTimer=this.theGame.time.events.loop(100,function(){e.updateTimer()}),this.backButton=this.theGame.add.button(0,0,"atlas",this.openMenu,this,"menu_button2.png","menu_button1.png"),this.backButton.anchor.setTo(.5),this.backButton.alignIn(this.theGame.camera.view,Phaser.TOP_LEFT),this.backButton.bringToTop(),console.log(this.backButton)}},{key:"update",value:function(){}},{key:"render",value:function(){}},{key:"checkForRoadStart",value:function(){var e=this.theTileMap.getTileRight(this.currentLayerIndex,this.sourceBlock.x,this.sourceBlock.y);e&&!0===e.properties.left&&(this.currentCell=null,this.alreadyMatched=[],this.deadEnds=[],this.alreadyMatched[0]=e,this.cycles=0,this.traversePath(e))}},{key:"traversePath",value:function(e){if(!1===this.done){var t=this.testConnections(e,this.alreadyMatched);if(!0===this.done)return;if(this.cycles=this.cycles+1,t=this.testConnections(e,this.alreadyMatched)){if(this.alreadyMatched.push(e),e=null,t&&t.length)for(var s=0;s<=t.length;s++)t[s]&&(e=t[s]);e&&(this.cycles<20?this.traversePath(e):console.log("cycle limit reached"))}else this.deadEnds.includes(e)||e&&this.deadEnds.push(e),this.cycles<20?this.alreadyMatched.length&&(e=this.alreadyMatched[this.alreadyMatched.length],this.traversePath(e)):console.log("cycle limit reached, dead end")}}},{key:"testConnections",value:function(e,t){var s=[];if(e&&e.properties){var i=this.theTileMap.getTileAbove(this.currentLayerIndex,e.x,e.y),a=this.theTileMap.getTileBelow(this.currentLayerIndex,e.x,e.y),h=this.theTileMap.getTileLeft(this.currentLayerIndex,e.x,e.y),l=this.theTileMap.getTileRight(this.currentLayerIndex,e.x,e.y),n=e.properties;if(i)var r=i.properties;if(a)var o=a.properties;if(h)var c=h.properties;if(l)var u=l.properties;return r&&!0===r.bottom&&!0===n.top&&(t.includes(i)||this.deadEnds.includes(i)||s.push(i)),o&&!0===o.top&&!0===n.bottom&&(t.includes(a)||this.deadEnds.includes(a)||s.push(a)),c&&!0===c.right&&!0===n.left&&(t.includes(h)||this.deadEnds.includes(h)||s.push(h)),!u||(console.log(u),!0!==u.left||!0!==n.right||t.includes(l)||this.deadEnds.includes(l)||(s.push(l),"destination"!==u.type))?s.length?s:null:(console.log("donne"),this.currentCell=null,this.alreadyMatched=[],this.cycles=0,this.done=!0,void this.theGame.state.start("LevelComplete"))}}},{key:"getTileProperties",value:function(){var e=this.layer1.getTileX(this.theGame.input.activePointer.worldX),t=this.layer1.getTileY(this.theGame.input.activePointer.worldY),s=this.theTileMap.getTile(e,t);return this.selectedTilesArray.length||"connector"!==s.properties.type&&"blank"!==s.properties.type?!0!==this.selected||(s||console.log("drop selection"),!s||"connector"!==s.properties.type&&"blank"!==s.properties.type)?void 0:(this.selectedTilesArray[1]=s,this.swap(),void this.remove_selector()):(this.selectedTilesArray[0]=s,this.selected=!0,void this.create_selector(s.worldX,s.worldY))}},{key:"swap",value:function(){var e=this.selectedTilesArray[0],t=new Phaser.Tile(this.currentLayerIndex),s=this.selectedTilesArray[1],i=new Phaser.Tile(this.currentLayerIndex);for(var a in s)s.hasOwnProperty(a)&&(i[a]=s[a]);for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);this.theTileMap.putTile(e,i.x,i.y,this.currentLayerIndex),this.theTileMap.putTile(i,t.x,t.y,this.currentLayerIndex),this.selectedTilesArray=[],this.selected=!1,this.done=!1,this.checkForRoadStart()}},{key:"create_selector",value:function(e,t){this.selector&&e&&t&&(this.selector.bringToTop(),this.selector.z=20,this.selector.x=e,this.selector.y=t,this.selector.visible=!0)}},{key:"remove_selector",value:function(){this.selector.visible=!1}},{key:"change_level",value:function(){var e=this;this.layer1.destroy(),this.layer1=this.theTileMap.createLayer(this.level),this.layer1.exists=!0,this.theTileMap.setLayer(this.layer1),this.currentLayerIndex=this.theTileMap.getLayer(this.theTileMap.currentLayer),this.selector.bringToTop(),this.selectedTilesArray=[],this.selected=!1,this.deadEnds=[],this.alreadyMatched=[],this.currentCell=null,this.cycles=0,this.done=!1,this.theTileMap.forEach(function(t){t.properties&&("source"===t.properties.type&&(e.sourceBlock=t,e.firstInChain=e.theTileMap.getTileRight(e.currentLayerIndex,e.sourceBlock.x,e.sourceBlock.y)),"destination"===t.properties.type&&(e.destinationBlock=t))},this,0,0,6,6,this.currentLayerIndex),console.log(this.sourceBlock)}},{key:"updateMarker",value:function(){this.marker.x=64*this.layer1.getTileX(this.theGame.input.activePointer.worldX),this.marker.y=64*this.layer1.getTileY(this.theGame.input.activePointer.worldY)}},{key:"createTimer",value:function(){this.timeLabel=this.theGame.add.bitmapText(10,100,"gem","00:00",18),this.timeLabel.alignIn(this.theGame.camera.view,Phaser.TOP_RIGHT),this.timeLabel.anchor.setTo(.5,0),this.timeLabel.align="center"}},{key:"updateTimer",value:function(){var e=new Date,t=this.startTime.getTime()-e.getTime();this.timeElapsed=Math.abs(t/1e3);var s=this.timeElapsed,i=Math.floor(s/60),a=Math.floor(s)-60*i,h=i<10?"0"+i:i;h+=a<10?":0"+a:":"+a,this.timeLabel.text=h,this.theGame.score=h}},{key:"openMenu",value:function(){this.theGame.state.start("GameMenu")}}]),h}(Phaser.State),r=function(a){function h(){return e(this,h),i(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,a),t(h,[{key:"init",value:function(){}},{key:"preload",value:function(){}},{key:"create",value:function(){}},{key:"update",value:function(){}},{key:"render",value:function(){}}]),h}(Phaser.State),o=function(a){function h(){return e(this,h),i(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,a),t(h,[{key:"init",value:function(){this.theGame=this.game.state.game,this.score=0}},{key:"preload",value:function(){}},{key:"create",value:function(){this.cursors=this.theGame.input.keyboard.createCursorKeys(),this.theGame.physics.startSystem(Phaser.Physics.ARCADE),this.theGame.add.sprite(0,0,"sky"),this.platforms=this.theGame.add.group(),this.platforms.enableBody=!0,this.ground=this.platforms.create(0,this.theGame.world.height-64,"ground"),this.ground.scale.setTo(2,2),this.ground.body.immovable=!0,this.ledge=this.platforms.create(400,480,"ground"),this.ledge.body.immovable=!0,this.ledge=this.platforms.create(-100,440,"ground"),this.ledge.body.immovable=!0,this.ledge=this.platforms.create(200,400,"ground"),this.ledge.scale.setTo(.2,.5),this.ledge.body.immovable=!0,this.player=this.theGame.add.sprite(32,this.theGame.world.height-150,"dude"),this.theGame.physics.arcade.enable(this.player),this.player.body.bounce.y=.2,this.player.body.gravity.y=900,this.player.body.collideWorldBounds=!0,this.player.animations.add("left",[0,1,2,3],10,!0),this.player.animations.add("right",[5,6,7,8],10,!0),this.stars=this.theGame.add.group(),this.stars.enableBody=!0;for(var e=0;e<12;e++){var t=this.stars.create(70*e,0,"star");t.body.gravity.y=900,t.body.bounce.y=.7+.2*Math.random()}this.scoreText=this.theGame.add.text(650,0,"score: 0",{font:"18px Arial",fill:"#ffffff",align:"right"}),this.scoreText.fixedToCamera=!0,this.scoreText.cameraOffset.setTo(650,0),this.seeker=this.theGame.add.sprite(400,300,"../assets/images/diamond.png"),this.seeker.anchor.setTo(.5,.5),this.theGame.physics.enable(this.seeker,Phaser.Physics.ARCADE),this.seeker.body.allowRotation=!1,this.pause_menu()}},{key:"update",value:function(){this.theGame.world.setBounds(0,0,1920,1920),this.theGame.camera.follow(this.player,Phaser.Camera.FOLLOW_LOCKON,.1,.1);var e=this.theGame.physics.arcade.collide(this.player,this.platforms);this.player.body.velocity.x=0,this.cursors.left.isDown?(this.player.body.velocity.x=-150,this.player.animations.play("left")):this.cursors.right.isDown?(this.player.body.velocity.x=150,this.player.animations.play("right")):(this.player.animations.stop(),this.player.frame=4),this.cursors.up.isDown&&this.player.body.touching.down&&e&&(this.player.body.velocity.y=-350),this.theGame.physics.arcade.collide(this.stars,this.platforms),this.theGame.physics.arcade.overlap(this.player,this.stars,this.collectStar,null,this),this.seeker.rotation=this.theGame.physics.arcade.moveToPointer(this.seeker,60,this.theGame.input.activePointer,500)}},{key:"render",value:function(){var e=this.theGame.debug;e.scale(20,20,"#fff"),e.phaser(10,580)}},{key:"pause_menu",value:function(){var e=800,t=600;a(this),console.log(this.theGame);var s=this;function i(){s.theGame.paused=!0,s.pause_button.destroy(),s.menu=s.theGame.add.sprite(e/2,t/2,"menu");var i=s.theGame.camera.x,h=s.theGame.camera.y;s.choiceLabel=s.theGame.add.text(e/2,t-150,"Click outside menu to continue",{font:"30px Arial",fill:"#fff"}),s.menu.x=i+e/2-135,s.menu.y=h+t/2-90,s.menu.x=s.theGame.camera.x+e/2-135,s.menu.y=s.theGame.camera.y+t/2-90,s.choiceLabel.x=s.menu.x,s.choiceLabel.y=s.menu.y+t/3.5,s.resume_button=s.theGame.add.button(s.theGame.world.centerX,s.theGame.world.centerY,"resumeButton",function(e){s.resume_button.setFrames(0,1,2),s.theGame.paused&&(s.menu.destroy(),s.choiceLabel.destroy(),s.resume_button.destroy(),s.theGame.paused=!1,a(s))},s,1,0,2),s.resume_button.x=i+e/2-32,s.resume_button.y=h+20,s.theGame.input.onDown.add(function(i){if(s.theGame.paused){var a=e/2-135,h=e/2+135,l=t/2-90,n=t/2+90;if(i.x>a&&i.x<h&&i.y>l&&i.y<n){var r=i.x-a,o=i.y-l,c=Math.floor(r/90)+3*Math.floor(o/90);s.choiceLabel.text="You chose menu item: "+["one","two","three","four","five","six"][c]}}},s)}function a(t){t.pause_button=t.theGame.add.button(t.theGame.world.centerX,t.theGame.world.centerY,"pauseButton",i,this,1,0,2),t.pause_button.fixedToCamera=!0,t.pause_button.cameraOffset.setTo(e/2-32,20)}}},{key:"collectStar",value:function(e,t){t.kill(),this.score+=10,console.log(this.score),this.scoreText.text="score: "+this.score}}]),h}(Phaser.State),c=function(a){function h(){return e(this,h),i(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,a),t(h,[{key:"init",value:function(){}},{key:"preload",value:function(){}},{key:"create",value:function(){}},{key:"update",value:function(){}},{key:"render",value:function(){}}]),h}(Phaser.State),u=function(a){function h(){return e(this,h),i(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,a),t(h,[{key:"init",value:function(){this.theGame=this.game.state.game,this.score=this.theGame.completionTime}},{key:"preload",value:function(){}},{key:"create",value:function(){this.lvl_select_bg=this.theGame.add.sprite(0,0,"atlas"),this.lvl_select_bg.alignIn(this.theGame.camera.view,Phaser.BOTTOM_CENTER),this.level1Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.level1,this,"lvl2.png","lvl1.png"),this.level1Button.anchor.setTo(.5),this.level2Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.level2,this,"lvl4.png","lvl3.png"),this.level2Button.anchor.setTo(-.8,.5),this.level3Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.level3,this,"lvl6.png","lvl5.png"),this.level3Button.anchor.setTo(-2.1,.5),this.level4Button=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.level4,this,"lvl8.png","lvl7.png"),this.level4Button.anchor.setTo(-3.4,.5),this.lvl_select_bg.addChild(this.level1Button),this.lvl_select_bg.addChild(this.level2Button),this.lvl_select_bg.addChild(this.level3Button),this.lvl_select_bg.addChild(this.level4Button),this.lvl_select_bg.frameName="level_select_bg.png",this.scoreText=this.theGame.add.bitmapText(10,100,"gem","00:00",42),this.scoreText.text=this.theGame.score,this.scoreText.alignIn(this.theGame.camera.view,Phaser.CENTER),this.nextButton=this.theGame.add.button(this.width/2,this.height/2,"atlas",this.next_level,this,"next_button2.png","next_button1.png"),this.nextButton.alignIn(this.theGame.camera.view,Phaser.TOP_CENTER)}},{key:"level1",value:function(){this.startLevel(0)}},{key:"level2",value:function(){this.startLevel(1)}},{key:"level3",value:function(){this.startLevel(2)}},{key:"level4",value:function(){this.startLevel(3)}},{key:"next_level",value:function(){console.log("next level"),this.theGame.theLevel<4&&(this.theGame.theLevel=this.theGame.theLevel+1),4===this.theGame.theLevel&&(this.theGame.theLevel=0),console.log(this.theGame.theLevel),this.startLevel(this.theGame.theLevel)}},{key:"startLevel",value:function(e){this.theGame.theLevel=e,this.theGame.state.start("Game")}}]),h}(Phaser.State),d=function(a){function h(){return e(this,h),i(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return s(h,a),t(h,[{key:"init",value:function(){this.theGame=this.game.state.game,this.addedStates=!1,this.theGame.load.onLoadStart.add(this.loadStart,this),this.theGame.load.onFileComplete.add(this.fileComplete,this),this.theGame.load.onLoadComplete.add(this.loadComplete,this),this.theGame.scale.aspectRatio=1,console.log(this.theGame.scale.aspectRatio),console.log(this.theGame)}},{key:"preload",value:function(){this.theGame.load.tilemap("map2","assets/images/tilemap_2.json",null,Phaser.Tilemap.TILED_JSON),this.theGame.load.tilemap("map3","assets/images/tilemap_3.json",null,Phaser.Tilemap.TILED_JSON),this.theGame.load.image("tiles","./assets/images/tilemap.png"),this.theGame.load.atlas("atlas","assets/images/atlas.png","assets/images/atlas.json"),this.theGame.load.image("button_bg","./assets/images/button_background.png"),this.theGame.load.image("sky","./assets/images/sky.png"),this.theGame.load.image("ground","./assets/images/platform.png"),this.theGame.load.image("star","./assets/images/star.png"),this.theGame.load.spritesheet("dude","./assets/images/dude.png",32,48),this.theGame.load.spritesheet("resumeButton","./assets/pause_menu/resume_button.png",32,32),this.theGame.load.spritesheet("pauseButton","./assets/pause_menu/pause_button.png",32,32),this.theGame.load.image("menu","./assets/images/number-buttons-90x90.png",270,180),this.theGame.load.bitmapFont("carrier_command","assets/fonts/carrier_command.png","assets/fonts/carrier_command.xml"),this.theGame.load.bitmapFont("gem","assets/fonts/gem.png","assets/fonts/gem.xml"),this.theGame.load.spritesheet("menu_start_button","./assets/main_menu/play_button.png",128,32),this.theGame.load.image("menu_bg","./assets/main_menu/menu_bg.png")}},{key:"create",value:function(){this.bmpText=this.theGame.add.bitmapText(10,100,"gem","LOADING...",34),this.addGameStates(),this.addGameMusic(),this.leftKey=this.theGame.input.keyboard.addKey(Phaser.Keyboard.LEFT),this.rightKey=this.theGame.input.keyboard.addKey(Phaser.Keyboard.RIGHT),this.spaceKey=this.theGame.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)}},{key:"update",value:function(){this.addedStates&&this.filesLoaded&&this.theGame.state.start("GameMenu")}},{key:"addGameStates",value:function(){this.theGame.state.add("GameMenu",l),this.theGame.state.add("Game",n),this.theGame.state.add("GameOver",r),this.theGame.state.add("Credits",o),this.theGame.state.add("Options",c),this.theGame.state.add("LevelComplete",u),this.addedStates=!0}},{key:"addGameMusic",value:function(){}},{key:"loadStart",value:function(){console.log("loading")}},{key:"fileComplete",value:function(e,t,s,i,a){console.log(e)}},{key:"loadComplete",value:function(){this.filesLoaded=!0}}]),h}(Phaser.State);new(function(t){function a(){e(this,a);var t=i(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,{renderer:Phaser.AUTO,width:384,height:384,aspectRatio:1,crisp:!0,roundPixels:!0,alignH:!0,alignV:!0,scaleH:1,scaleV:1,trimH:0,trimV:0,scaleMode:Phaser.ScaleManager.SHOW_ALL,antialias:!0}));return t.state.add("Boot",d,!1),t.state.start("Boot"),t}return s(a,t),a}(Phaser.Game))}();
//# sourceMappingURL=compiled.js.map
